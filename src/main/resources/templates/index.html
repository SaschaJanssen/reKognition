<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Image reKognition Service</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
          integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

</head>

<style>
    .wrapper {
        width: 807px;
        height: 550px;
        margin: 20px 60px;
    }

    .insideWrapper {
        width: 100%;
        height: 100%;
        position: relative;
    }

    .image {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0px;
        left: 0px;
    }

    #can {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0px;
        left: 0px;
    }
</style>

<body class="text-center">

<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header class="masthead mb-auto">
        <div class="inner">
            <h3 class="masthead-brand">reKognition</h3>
        </div>
    </header>

    <main role="main" class="inner cover">

        <!--
        <div id="webcamcontainer">
            <video id="videoElement" width="640" height="480" style="display:none" ></video>
            <canvas id="videoCan" width="640" height="480"></canvas>
        </div>

        -->

        <div class="wrapper">
            <div class="insideWrapper">
                <img th:src="@{/kid.jpg}" src="../static/kid.jpg" alt="kid" class="image"/>
                <canvas id="can"></canvas>
            </div>
        </div>
        <p class="info" id="info">
            Stand by, calculating data ... {{ items }}
        </p>
    </main>

    <footer class="mastfoot mt-auto">
        <div class="inner">
            <p>reKognition Service</p>
        </div>
    </footer>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>

<script>

    var jsonStr = "[{\"boundingBox\":{\"width\":0.29555556,\"height\":0.4336606,\"left\":0.27666667,\"top\":0.15650909},\"ageRange\":{\"low\":48,\"high\":68},\"smile\":{\"value\":false,\"confidence\":95.72534},\"eyeglasses\":{\"value\":false,\"confidence\":99.999664},\"sunglasses\":{\"value\":false,\"confidence\":99.98244},\"gender\":{\"value\":\"Male\",\"confidence\":99.91686},\"beard\":{\"value\":false,\"confidence\":90.305084},\"mustache\":{\"value\":false,\"confidence\":81.29401},\"eyesOpen\":{\"value\":true,\"confidence\":99.98767},\"mouthOpen\":{\"value\":false,\"confidence\":99.54492},\"emotions\":[{\"type\":\"HAPPY\",\"confidence\":41.575005},{\"type\":\"CONFUSED\",\"confidence\":5.7561874},{\"type\":\"ANGRY\",\"confidence\":3.5241902}],\"landmarks\":[{\"type\":\"eyeLeft\",\"x\":0.3921856,\"y\":0.31334782},{\"type\":\"eyeRight\",\"x\":0.47952366,\"y\":0.34062228},{\"type\":\"nose\",\"x\":0.43863112,\"y\":0.3942222},{\"type\":\"mouthLeft\",\"x\":0.38516405,\"y\":0.4643265},{\"type\":\"mouthRight\",\"x\":0.44491053,\"y\":0.48029292},{\"type\":\"leftPupil\",\"x\":0.3927895,\"y\":0.3141572},{\"type\":\"rightPupil\",\"x\":0.48137736,\"y\":0.34315738},{\"type\":\"leftEyeBrowLeft\",\"x\":0.36327213,\"y\":0.2576065},{\"type\":\"leftEyeBrowUp\",\"x\":0.38911784,\"y\":0.24199821},{\"type\":\"leftEyeBrowRight\",\"x\":0.41669592,\"y\":0.25943166},{\"type\":\"rightEyeBrowLeft\",\"x\":0.4719392,\"y\":0.2709738},{\"type\":\"rightEyeBrowUp\",\"x\":0.49631295,\"y\":0.27647832},{\"type\":\"rightEyeBrowRight\",\"x\":0.5099202,\"y\":0.30640864},{\"type\":\"leftEyeLeft\",\"x\":0.3760131,\"y\":0.30934602},{\"type\":\"leftEyeRight\",\"x\":0.4081566,\"y\":0.3197386},{\"type\":\"leftEyeUp\",\"x\":0.39304858,\"y\":0.30522832},{\"type\":\"leftEyeDown\",\"x\":0.39142334,\"y\":0.32027274},{\"type\":\"rightEyeLeft\",\"x\":0.46269524,\"y\":0.33791488},{\"type\":\"rightEyeRight\",\"x\":0.4956367,\"y\":0.34766626},{\"type\":\"rightEyeUp\",\"x\":0.48073268,\"y\":0.33279672},{\"type\":\"rightEyeDown\",\"x\":0.47867233,\"y\":0.34627953},{\"type\":\"noseLeft\",\"x\":0.41053936,\"y\":0.4156093},{\"type\":\"noseRight\",\"x\":0.44623518,\"y\":0.42506477},{\"type\":\"mouthUp\",\"x\":0.41915065,\"y\":0.45633817},{\"type\":\"mouthDown\",\"x\":0.41557914,\"y\":0.48591575}],\"pose\":{\"roll\":10.918993,\"yaw\":14.431332,\"pitch\":5.229652},\"quality\":{\"brightness\":48.149563,\"sharpness\":99.97486},\"confidence\":99.766335},{\"boundingBox\":{\"width\":0.19888888,\"height\":0.29019395,\"left\":0.5988889,\"top\":0.17281212},\"ageRange\":{\"low\":20,\"high\":38},\"smile\":{\"value\":false,\"confidence\":99.76129},\"eyeglasses\":{\"value\":false,\"confidence\":99.93552},\"sunglasses\":{\"value\":false,\"confidence\":99.85741},\"gender\":{\"value\":\"Male\",\"confidence\":99.87342},\"beard\":{\"value\":false,\"confidence\":99.99042},\"mustache\":{\"value\":false,\"confidence\":99.994675},\"eyesOpen\":{\"value\":true,\"confidence\":99.993065},\"mouthOpen\":{\"value\":false,\"confidence\":99.82943},\"emotions\":[{\"type\":\"SAD\",\"confidence\":54.774952},{\"type\":\"HAPPY\",\"confidence\":13.188026},{\"type\":\"CALM\",\"confidence\":3.5666287}],\"landmarks\":[{\"type\":\"eyeLeft\",\"x\":0.663961,\"y\":0.2792269},{\"type\":\"eyeRight\",\"x\":0.7388187,\"y\":0.2854208},{\"type\":\"nose\",\"x\":0.7052441,\"y\":0.32966956},{\"type\":\"mouthLeft\",\"x\":0.6740365,\"y\":0.3937192},{\"type\":\"mouthRight\",\"x\":0.7235716,\"y\":0.4001484},{\"type\":\"leftPupil\",\"x\":0.66220695,\"y\":0.275382},{\"type\":\"rightPupil\",\"x\":0.741193,\"y\":0.28145337},{\"type\":\"leftEyeBrowLeft\",\"x\":0.6325358,\"y\":0.255799},{\"type\":\"leftEyeBrowUp\",\"x\":0.65711606,\"y\":0.23744737},{\"type\":\"leftEyeBrowRight\",\"x\":0.6842522,\"y\":0.24571891},{\"type\":\"rightEyeBrowLeft\",\"x\":0.7252169,\"y\":0.24901436},{\"type\":\"rightEyeBrowUp\",\"x\":0.74827945,\"y\":0.24439423},{\"type\":\"rightEyeBrowRight\",\"x\":0.7666347,\"y\":0.2643391},{\"type\":\"leftEyeLeft\",\"x\":0.646958,\"y\":0.28171727},{\"type\":\"leftEyeRight\",\"x\":0.68068683,\"y\":0.2819546},{\"type\":\"leftEyeUp\",\"x\":0.66380227,\"y\":0.26937953},{\"type\":\"leftEyeDown\",\"x\":0.6642583,\"y\":0.28646526},{\"type\":\"rightEyeLeft\",\"x\":0.7233893,\"y\":0.28470284},{\"type\":\"rightEyeRight\",\"x\":0.75345737,\"y\":0.29017124},{\"type\":\"rightEyeUp\",\"x\":0.73924744,\"y\":0.275836},{\"type\":\"rightEyeDown\",\"x\":0.7387851,\"y\":0.29298934},{\"type\":\"noseLeft\",\"x\":0.68702596,\"y\":0.35216585},{\"type\":\"noseRight\",\"x\":0.71559644,\"y\":0.35419425},{\"type\":\"mouthUp\",\"x\":0.7027905,\"y\":0.37912276},{\"type\":\"mouthDown\",\"x\":0.7007534,\"y\":0.4055831}],\"pose\":{\"roll\":2.7940443,\"yaw\":3.511755,\"pitch\":6.412383},\"quality\":{\"brightness\":47.772278,\"sharpness\":99.808136},\"confidence\":99.99879}]"
    var json = JSON.parse(jsonStr);

    //$("#info").text(JSON.stringify(json[0], null, 2));

    var redrawTimeoutOnCanvas = 20;

    function draw() {
        var c = document.getElementById("videoCan");
        var context = c.getContext('2d');
        context.beginPath();
        context.clearRect(0, 0, 640, 480);
        context.drawImage(video, 0, 0, 640, 480);

    };

    /*
	video = document.querySelector("#videoElement");
	
	navigator.mediaDevices.getUserMedia({video:{width:640, height:480}})
                .then(handleVideo)
                .catch(videoError);
        
            function handleVideo(stream) {
                video.srcObject = stream;
                video.play();
                drawtimer = setInterval(draw, redrawTimeoutOnCanvas);
            }
        
            function videoError(e) {
                alert(e);
			}
    */

    function drawReact(ctx, person) {

        var leftX = ctx.canvas.width * person.boundingBox.left;
        var leftY = ctx.canvas.height * person.boundingBox.top;
        var width = ctx.canvas.width * person.boundingBox.width;
        var height = ctx.canvas.height * person.boundingBox.height;

        var ageText = "Age " + person.ageRange.low
        var gender = person.gender.value

        ctx.beginPath();
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(leftX + 5, leftY + height + 2, ctx.measureText(ageText).width + 10, 14);
        ctx.fillRect(leftX + 5, leftY + height + 15, ctx.measureText(gender).width + 10, 14);

        ctx.fillStyle = 'red';
        ctx.font = '10pt Arial';
        ctx.fillText("Age " + person.ageRange.low, leftX + 5, leftY + height + 14);

        ctx.fillText(gender, leftX + 5, leftY + height + 28);

        ctx.stroke();


        ctx.beginPath();
        ctx.lineWidth = "1";
        ctx.strokeStyle = "yellow";

        ctx.rect(leftX, leftY, width, height);
        ctx.stroke();

    }

    var c = document.getElementById("can");
    var ctx = c.getContext("2d");

    $.each(json, function () {
        drawReact(ctx, this)
    });

    $.getJSON('/imageinfo', function (data) {
        console.log(data)
    });


</script>

</body>

</html>